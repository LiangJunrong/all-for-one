<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>抽奖</title>
  <style>
    .container {
      width: 900px;
      margin: 0 auto;

      /* 垃圾 CSS */
      background: deepskyblue;
      padding: 30px;
    }
    
    .lotteryResult {
      width: 20px;
      height: 20px;
      position: relative;
      display: inline-block;
      overflow: hidden;
    }
    span {
      display: inline-block;
      line-height: 20px;
      text-align: center;
      overflow: hidden;
    }
    span i {
      width: 20px;
      height: 20px;
      display: block;
      text-align: center;
      font-style: normal;
    }
  </style>
</head>
<body>
  <div class="container">
    <div>
      <span>抽奖范围： </span>
      <input class="numberStart" type="number">-<input class="numberEnd" type="number">
      <button class="lockNumber">锁定</button>
      <button class="unlockNumber">解锁</button>
    </div>
    <button class="start">开始</button>
    <div id="lotteryResult"></div>
  </div>

  <script>
    window.onload = () => {
      // 步骤 1：获取元素
      const numberStart = document.querySelector('.numberStart'),
        numberEnd = document.querySelector('.numberEnd'),
        start = document.querySelector('.start');
        // lotteryResult = document.querySelector('#lotteryResult');
        lockNumber = document.querySelector('.lockNumber');
        unlockNumber = document.querySelector('.unlockNumber');

      let locked = false;
      numberStart.value = localStorage.getItem('numberStart') || '';
      numberEnd.value = localStorage.getItem('numberEnd') || '';

      // 步骤 2：锁抽奖数字范围
      lockNumber.onclick = () => {
        locked = true;
        const startValue = numberStart.value;
        const endValue = numberEnd.value;
        if (Number(startValue) > Number(endValue)) {
          alert('开始范围请小于结束范围！');
          return;
        }
        localStorage.setItem('numberStart', startValue);
        localStorage.setItem('numberEnd', endValue);
        numberStart.disabled = true;
        numberEnd.disabled = true;
      };
      unlockNumber.onclick = () => {
        locked = false;
        localStorage.setItem('numberStart', '');
        localStorage.setItem('numberEnd', '');
        numberStart.disabled = false;
        numberEnd.disabled = false;
      };

      // 步骤 3：开始抽奖
      const getRandom = (start, end) => {
        return Math.floor(Math.random() * (end - start + 1)) + start;
      };
      start.onclick = () => {
        if (!locked) {
          alert('请先锁定再抽奖，避免号码出错！');
          return;
        }
        const random = getRandom(Number(numberStart.value), Number(numberEnd.value));
        play(random);
        // document.querySelector('.lotteryResult').innerHTML = random;
      };

      const play = (result) => {
        let threshold = 10; // 临界点
        let html = '';
        let arr = String(result).split('');
        let len = arr.length;
        for (let i = 0; i < len; i++){
          if(arr[i] === '.'){
            html += '.';
            continue;
          }
          html += '<div id="num_'+ i +'" class="lotteryResult" data-id="'+i+'">';
          html += retuen10(threshold);
          html += '</div>';
        }
        document.querySelector('#lotteryResult').innerHTML = html;
        let lotteryResult = document.querySelectorAll('.lotteryResult');
        let spanHeight = lotteryResult[0].querySelector('span').offsetHeight;
        let numlen = lotteryResult.length;
        for (let j = 0; j < numlen; j++){
          let newi = document.createElement('i');
          newi.innerHTML=arr[lotteryResult[j].getAttribute('data-id')];
          lotteryResult[j].querySelector('span').appendChild(newi);
          lotteryResult[j].querySelector('span').style.webkitTransition='all '+(.9+j*.1)+'s ease-in .1s';
          lotteryResult[j].querySelector('span').style.webkitTransform='translate3d(0,-'+ spanHeight +'px,0)';
        }
      }

      function retuen10(lotteryResult){
        let html = '';
        html += '<span>';
        for(let i = 0; i < lotteryResult; i++){
          for(let j = 0; j < 10; j++){
            html += '<i>'+ j +'</i>';
          }
        }
        html += '</span>';
        return html;
      }
      
      // 步骤 3：存储抽奖结果
    };
  </script>
</body>
</html>